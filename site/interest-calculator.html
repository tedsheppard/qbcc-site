<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-QEN3X3DQLR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-QEN3X3DQLR');
  </script>
  <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon">
  <meta charset="utf-8">
  <title>Sopal – Interest Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  /* Base styles matching main site */
  body {
    font-family: Inter, sans-serif;
    margin: 0;
    background: #ffffff;
    color: #222;
    font-size: 15px;
    line-height: 1.6;
  }

  /* Header */
  .header {
    background: #fdfdfd;
    padding: 20px 25px;
    border-bottom: 1px solid #ddd;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .header-content {
    display: flex;
    align-items: center;
    max-width: 1200px;
    margin: 0 auto;
  }
  .logo {
    height: 31px;
    margin-right: 20px;
  }
  .nav-links {
    margin-left: auto;
    display: flex;
    gap: 20px;
  }
  .nav-links a {
    color: black;
    text-decoration: none;
    font-size: 14px;
    transition: color 0.2s;
  }
  .nav-links a:hover {
    color: #00c97c;
  }
  .nav-links a.active {
    color: #00c97c;
    font-weight: 600;
  }
  main {
    max-width: 900px;
    margin: 40px auto;
    padding: 0 25px;
  }
  h1 {
    font-size: 28px;
    border-bottom: 1px solid #eee;
    padding-bottom: 15px;
    margin-bottom: 20px;
  }

  /* Calculator styles */
  .calculator-container {
    background: #fdfdfd;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 25px;
    margin-top: 30px;
  }
  .tabs {
    display: flex;
    border-bottom: 1px solid #ddd;
    margin-bottom: 20px;
  }
  .tab-button {
    padding: 10px 20px;
    cursor: pointer;
    border: none;
    background: transparent;
    font-size: 16px;
    color: #555;
    border-bottom: 3px solid transparent;
    margin-bottom: -1px;
  }
  .tab-button.active {
    color: #00c97c;
    border-bottom: 3px solid #00c97c;
    font-weight: 600;
  }
  .tab-content {
    display: none;
  }
  .tab-content.active {
    display: block;
  }
  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }
  .form-group {
    display: flex;
    flex-direction: column;
  }
  .form-group label {
    margin-bottom: 8px;
    font-weight: 500;
    font-size: 14px;
  }
  .form-group input {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 15px;
    font-family: Inter, sans-serif;
  }
  .calculate-btn {
    margin-top: 25px;
    padding: 12px 20px;
    background: #00c97c;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: background 0.2s;
  }
  .calculate-btn:hover {
    background: #00a568;
  }
  #results {
    margin-top: 30px;
  }
  .results-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  .results-table th, .results-table td {
    border: 1px solid #ddd;
    padding: 12px;
    text-align: left;
  }
  .results-table th {
    background-color: #f7f7f7;
  }
  .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
  }
  .copy-btn {
    padding: 8px 12px;
    background: #efefef;
    color: #333;
    border: 1px solid #ccc;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    transition: background 0.2s;
  }
  .copy-btn:hover {
    background: #e0e0e0;
  }

  /* Collapsible box styles */
  .provision-box {
    margin-top: 20px;
    padding: 20px;
    background: #f0f9f4;
    border-left: 4px solid #10b981;
    border-radius: 4px;
    font-size: 14px;
  }
  .provision-box summary {
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
    color: #059669;
  }
  .provision-box[open] summary {
      margin-bottom: 15px;
  }
  .provision-box summary::marker {
      color: #059669;
  }
  .provision-box ul {
    padding-left: 20px;
    list-style-type: none;
  }
   .provision-box ul ul {
    padding-left: 20px;
    list-style-type: disc;
  }
  .provision-content p {
      margin-top: 10px;
      margin-bottom: 10px;
  }


  /* Disclaimer styles */
  .disclaimer {
    margin-top: 40px;
    padding: 20px;
    background: #fffbeb;
    border-left: 4px solid #fbbF24;
    border-radius: 4px;
  }
  .disclaimer h3 {
    margin-top: 0;
    color: #b45309;
  }
  
  /* Footer */
  .footer {
    background: #fcfcfc;
    color: #333;
    padding: 40px 20px 20px;
    margin-top: 60px;
    border-top: 1px solid #ddd;
  }
  .footer-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    max-width: 1200px;
    margin: auto;
  }
  .footer-left { max-width: 400px; }
  .footer-logo { height: 24px; margin-bottom: 10px; }
  .footer-links { display: flex; gap: 20px; }
  .footer-links a { color: #333; text-decoration: none; transition: color 0.2s; }
  .footer-links a:hover { color: #00c853; }
  .footer-bottom {
    text-align: center;
    border-top: 1px solid #eee;
    margin-top: 20px;
    padding-top: 15px;
    font-size: 0.85em;
    color: #666;
  }
</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <div class="header-content">
    <a href="/">
      <img id="logo" src="assets/sopal_logo_v1.png" alt="SOPAL" class="logo">
    </a>
    <div class="nav-links">
      <a href="index.html">Search</a>
      <a href="interest_calculator.html" class="active">Interest Calculator</a>
      <a href="feedback.html">Feedback</a>
      <a href="privacy.html">Privacy</a>
      <a href="terms.html">Terms</a>
    </div>
  </div>
</div>

<main>
  <h1>Interest Calculator</h1>
  <p>This tool helps calculate interest on late progress payments under a construction contract in Queensland, pursuant to the <em>Building Industry Fairness (Security of Payment) Act 2017</em> (Qld) (BIF Act).</p>
  
  <p>Interest is payable on late progress payments under section 73 of the BIF Act.</p>

  <details class="provision-box">
    <summary>Building Industry Fairness (Security of Payment) Act 2017 (Qld) – section 73</summary>
    <div class="provision-content">
        <p><strong>73 Due date for payment</strong></p>
        <ul>
            <li>(1) A progress payment under a construction contract becomes payable—
                <ul>
                    <li>(a) if the contract provides for the matter—on the day on which the payment becomes payable under the contract; or</li>
                    <li>(b) if the contract does not provide for the matter—on the day that is 10 business days after the day a payment claim for the progress payment is made under part 3.</li>
                </ul>
            </li>
            <li>(2) Interest for a construction contract is payable on the unpaid amount of a progress payment that has become payable at the greater of the following rates—
                <ul>
                    <li>(a) the rate stated in the contract;</li>
                    <li>(b) the rate prescribed under the Civil Proceedings Act 2011, section 59(3) for a money order debt.</li>
                </ul>
            </li>
            <li>(3) However, for a construction contract to which the Queensland Building and Construction Commission Act 1991, section 67P applies because it is a building contract, interest is payable at the penalty rate under that section.</li>
        </ul>
    </div>
  </details>

  <p style="margin-top: 20px;">As per section 73(3) of the BIF Act, the penalty interest rate under section 67P of the <em>Queensland Building and Construction Commission Act 1991</em> (QBCC Act) may apply. That section provides:</p>

  <details class="provision-box">
      <summary>Queensland Building and Construction Commission Act 1991 (Qld) – section 67P</summary>
      <div class="provision-content">
          <p><strong>67P Late progress payments</strong></p>
          <ul>
              <li>(1) This section applies if—
                  <ul>
                      <li>(a) the contracting party for a building contract is required to pay an amount (the progress amount) to the contracted party for the building contract; and</li>
                      <li>(b) the progress amount is payable as the whole or a part of a progress payment; and</li>
                      <li>(c) the time (the payment time) by which the progress amount is required to be paid has passed, and the progress amount, or a part of the progress amount, has not been paid.</li>
                  </ul>
              </li>
              <li>(2) For the period for which the progress amount, or the part of the progress amount, is still unpaid after the payment time, the contracting party is also required to pay the contracted party interest at the penalty rate, as applying from time to time, for each day the amount is unpaid.</li>
              <li>(3) In this section— <strong><em>penalty rate</em></strong> means—
                  <ul>
                      <li>(a) the rate made up of the sum of the following—
                          <ul>
                              <li>(i) 10% a year;</li>
                              <li>(ii) the rate comprising the annual rate, as published from time to time by the Reserve Bank of Australia, for 90 day bills; or</li>
                          </ul>
                      </li>
                      <li>(b) if the building contract provides for a higher rate of interest than the rate worked out under paragraph (a)—the higher rate.</li>
                  </ul>
              </li>
          </ul>
      </div>
  </details>

  <p style="margin-top: 30px;">Calculating the QBCC Act penalty rate requires the 90-day Bank Bill Swap Rate (BBSW), which is published daily by the Reserve Bank of Australia. Our calculator automatically fetches the latest official RBA statistics every day. By using the calculator, you acknolwedge and agree to our disclaimer below.</p>


  <div class="calculator-container">
    <div class="tabs">
      <button class="tab-button active" onclick="openTab(event, 'contractual')">Interest at Contractual Rate</button>
      <button class="tab-button" onclick="openTab(event, 'qbcc')">Interest at section 67P QBCC Act Rate</button>
    </div>

    <!-- Contractual Rate Calculator -->
    <div id="contractual" class="tab-content active">
      <p>Calculate simple interest based on an interest rate specified in your contract.</p>
      <div class="form-grid">
        <div class="form-group">
          <label for="contract-amount">Progress Payment Amount ($)</label>
          <input type="number" id="contract-amount" placeholder="e.g., 100000">
        </div>
        <div class="form-group">
          <label for="contract-rate">Annual Interest Rate (%)</label>
          <input type="number" id="contract-rate" placeholder="e.g., 5.5">
        </div>
        <div class="form-group">
          <label for="contract-due-date">Due Date for Payment</label>
          <input type="date" id="contract-due-date">
        </div>
        <div class="form-group">
          <label for="contract-calc-date">Date Interest Calculated To</label>
          <input type="date" id="contract-calc-date">
        </div>
      </div>
      <button class="calculate-btn" onclick="calculateContractualInterest()">Calculate Interest</button>
    </div>

    <!-- QBCC Act Rate Calculator -->
    <div id="qbcc" class="tab-content">
      <p>Calculate interest at the penalty rate under section 67P of the <em>Queensland Building and Construction Commission Act 1991</em> (Qld) (QBCC Act). This rate is 10% plus the 90-day Bank Bill Swap Rate (BBSW), which is updated daily.</p>
      <div class="form-grid">
        <div class="form-group">
          <label for="qbcc-amount">Progress Payment Amount ($)</label>
          <input type="number" id="qbcc-amount" placeholder="e.g., 100000">
        </div>
        <div class="form-group">
          <label for="qbcc-due-date">Due Date for Payment</label>
          <input type="date" id="qbcc-due-date">
        </div>
        <div class="form-group">
          <label for="qbcc-calc-date">Date Interest Calculated To</label>
          <input type="date" id="qbcc-calc-date">
        </div>
      </div>
      <button class="calculate-btn" onclick="calculateQbccInterest()">Calculate Interest</button>
    </div>
  </div>

  <div id="results"></div>

  <div class="disclaimer">
    <h3>Disclaimer</h3>
    <p>This interest calculator is provided as a guide only and should not be relied upon as a substitute for professional legal or financial advice. The calculations are based on the inputs you provide and, for the QBCC Act rate, on publicly available data from the Reserve Bank of Australia which we endeavour to updated daily.</p>
    <p>While we strive for accuracy, Sopal provides no warranty and accepts no liability for any loss or damage arising from the use of this calculator. Users should independently verify all calculations and, where applicable, the underlying RBA rates, before inclusion in any formal submission or legal document.</p>
  </div>
</main>

<footer class="footer">
    <div class="footer-content">
      <div class="footer-left">
        <img id="footerLogo" src="assets/sopal_logo_v1.png" alt="SOPAL" class="footer-logo">
        <p>An intelligent search tool for adjudication decisions under the Building Industry Fairness (Security of Payment) Act 2017 (Qld)</p>
      </div>
      <div class="footer-links">
        <a href="feedback.html">Send feedback</a>
        <a href="privacy.html">Privacy</a>
        <a href="terms.html">Terms</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>© 2025 SOPAL. All rights reserved.</p>
    </div>
</footer>

<script>
  // Set default calculation date to today
  document.getElementById('contract-calc-date').valueAsDate = new Date();
  document.getElementById('qbcc-calc-date').valueAsDate = new Date();

  function openTab(evt, tabName) {
    let i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tab-content");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tab-button");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
    document.getElementById('results').innerHTML = ''; // Clear results on tab switch
  }

  function calculateContractualInterest() {
    const principal = parseFloat(document.getElementById('contract-amount').value);
    const annualRate = parseFloat(document.getElementById('contract-rate').value);
    const dueDate = new Date(document.getElementById('contract-due-date').value);
    const calcDate = new Date(document.getElementById('contract-calc-date').value);

    if (isNaN(principal) || isNaN(annualRate) || isNaN(dueDate.getTime()) || isNaN(calcDate.getTime())) {
      displayError('Please fill in all fields with valid numbers and dates.');
      return;
    }
    
    if (calcDate < dueDate) {
      displayError('The "Date Interest Calculated To" must be after the "Due Date for Payment".');
      return;
    }

    const timeDiff = calcDate.getTime() - dueDate.getTime();
    const days = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;
    const dailyRate = annualRate / 365;
    const interest = principal * (dailyRate / 100) * days;

    displayResults({
      principal,
      annualRate,
      dueDate,
      calcDate,
      days,
      interest,
      rateType: 'Contractual'
    });
  }

  async function calculateQbccInterest() {
      const principal = parseFloat(document.getElementById('qbcc-amount').value);
      const dueDate = new Date(document.getElementById('qbcc-due-date').value);
      const calcDate = new Date(document.getElementById('qbcc-calc-date').value);

      if (isNaN(principal) || isNaN(dueDate.getTime()) || isNaN(calcDate.getTime())) {
        displayError('Please fill in all fields with valid numbers and dates.');
        return;
      }

      if (calcDate < dueDate) {
        displayError('The "Date Interest Calculated To" must be after the "Due Date for Payment".');
        return;
      }

      const startDateStr = dueDate.toISOString().split('T')[0];
      const endDateStr = calcDate.toISOString().split('T')[0];
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '<p>Fetching latest RBA rates for the period...</p>';

      try {
        const response = await fetch(`/get_interest_rate?startDate=${startDateStr}&endDate=${endDateStr}`);
        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || 'Failed to fetch interest rates from the server.');
        }
        const data = await response.json();
        
        let totalInterest = 0;
        
        for(const dailyData of data.dailyRates) {
            const penaltyRate = 10.0 + dailyData.rate;
            const dailyInterest = (principal / 365) * (penaltyRate / 100);
            totalInterest += dailyInterest;
        }
        
        const timeDiff = calcDate.getTime() - dueDate.getTime();
        const days = Math.ceil(timeDiff / (1000 * 3600 * 24)) + 1;

        const rates = data.dailyRates.map(r => r.rate);
        const minRate = Math.min(...rates);
        const maxRate = Math.max(...rates);

        displayResults({
          principal,
          annualRate: {min: 10 + minRate, max: 10 + maxRate},
          dueDate,
          calcDate,
          days,
          interest: totalInterest,
          rateType: 'QBCC Act section 67P',
          rbaRate: {min: minRate, max: maxRate},
          dailyRates: data.dailyRates
        });

      } catch (error) {
          displayError(`Error: ${error.message}`);
      }
  }
  
  function displayError(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<p style="color: red; border: 1px solid red; padding: 10px; border-radius: 6px; background-color: #ffebee;">${message}</p>`;
  }

  function displayResults(data) {
    const resultsDiv = document.getElementById('results');
    const { principal, annualRate, dueDate, calcDate, days, interest, rateType, rbaRate, dailyRates } = data;

    let rateDisplay, calcDisplay;
    let breakdownHtml = '';

    if (rateType === 'QBCC Act section 67P') {
        if (rbaRate.min.toFixed(2) === rbaRate.max.toFixed(2)) {
            rateDisplay = `${annualRate.max.toFixed(2)}% (10% + ${rbaRate.max.toFixed(2)}% RBA Rate)`;
            calcDisplay = `${principal.toLocaleString('en-AU', { style: 'currency', currency: 'AUD' })} × (${annualRate.max.toFixed(2)}% / 365) × ${days} days`;
        } else {
            rateDisplay = `From ${annualRate.min.toFixed(2)}% to ${annualRate.max.toFixed(2)}% (variable daily rate)`;
            calcDisplay = `Sum of daily interest calculated for ${days} days (see breakdown below)`;
        }

        if (dailyRates && dailyRates.length > 0) {
            breakdownHtml = `
              <h3 style="margin-top: 30px;">Daily Interest Breakdown</h3>
              <table class="results-table" id="results-breakdown-table">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>RBA Rate (%)</th>
                    <th>Penalty Rate (%)</th>
                    <th>Interest Accrued ($)</th>
                  </tr>
                </thead>
                <tbody>`;
            
            dailyRates.forEach(item => {
                const penaltyRate = 10.0 + item.rate;
                const dailyInterest = (principal / 365) * (penaltyRate / 100);
                // Adjust for timezone issues when creating date from YYYY-MM-DD string
                const itemDate = new Date(item.date);
                const displayDate = new Date(itemDate.getTime() + itemDate.getTimezoneOffset() * 60000);

                breakdownHtml += `
                  <tr>
                    <td>${displayDate.toLocaleDateString('en-AU')}</td>
                    <td>${item.rate.toFixed(2)}</td>
                    <td>${penaltyRate.toFixed(2)}</td>
                    <td>${dailyInterest.toLocaleString('en-AU', { style: 'currency', currency: 'AUD', minimumFractionDigits: 4 })}</td>
                  </tr>`;
            });
            breakdownHtml += '</tbody></table>';
        }
    } else {
        rateDisplay = `${annualRate.toFixed(2)}%`;
        calcDisplay = `${principal.toLocaleString('en-AU', { style: 'currency', currency: 'AUD' })} × (${annualRate.toFixed(2)}% / 365) × ${days} days`;
    }
        
    const summaryTableHtml = `
      <div class="results-header">
        <h2>Calculation Results</h2>
        <button class="copy-btn" onclick="copyResultsToClipboard()">Copy All Results</button>
      </div>
      <table class="results-table" id="results-summary-table">
        <tbody>
          <tr>
            <th>Principal Amount</th>
            <td>${principal.toLocaleString('en-AU', { style: 'currency', currency: 'AUD' })}</td>
          </tr>
          <tr>
            <th>Applicable Annual Interest Rate</th>
            <td>${rateDisplay}</td>
          </tr>
          <tr>
            <th>Interest Period</th>
            <td>From ${dueDate.toLocaleDateString('en-AU')} to ${calcDate.toLocaleDateString('en-AU')}</td>
          </tr>
          <tr>
            <th>Number of Days</th>
            <td>${days}</td>
          </tr>
          <tr>
            <th>Calculation</th>
            <td>${calcDisplay}</td>
          </tr>
          <tr>
            <th><strong>Total Interest Due</strong></th>
            <td><strong>${interest.toLocaleString('en-AU', { style: 'currency', currency: 'AUD' })}</strong></td>
          </tr>
        </tbody>
      </table>
    `;

    resultsDiv.innerHTML = summaryTableHtml + breakdownHtml;
  }

  function copyResultsToClipboard() {
    const summaryTable = document.getElementById('results-summary-table');
    const breakdownTable = document.getElementById('results-breakdown-table');
    let text = '--- Calculation Summary ---\n';

    const tableToTabText = (table) => {
        let tableText = "";
        if (!table) return tableText;

        const rows = table.querySelectorAll('tr');
        rows.forEach(row => {
            const cells = row.querySelectorAll('th, td');
            const rowText = Array.from(cells).map(cell => cell.innerText).join('\t');
            tableText += rowText + '\n';
        });
        return tableText;
    }
    
    text += tableToTabText(summaryTable);

    if (breakdownTable) {
        text += "\n--- Daily Interest Breakdown ---\n";
        text += tableToTabText(breakdownTable);
    }

    if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
            alert('Calculation results copied to clipboard!');
        }).catch(err => {
            console.error('Failed to copy with navigator.clipboard:', err);
            copyFallback(text);
        });
    } else {
        copyFallback(text);
    }
  }

  function copyFallback(text) {
      const textArea = document.createElement("textarea");
      textArea.value = text;
      textArea.style.position = 'fixed';
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();
      try {
          document.execCommand('copy');
          alert('Calculation results copied to clipboard!');
      } catch (err) {
          alert('Failed to copy text.');
      }
      document.body.removeChild(textArea);
  }

</script>

</body>
</html>
