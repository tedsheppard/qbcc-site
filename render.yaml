services:
  - type: web
    name: qbcc-site
    env: python
    plan: free
    buildCommand: |
      echo ">>> Installing dependencies"
      pip install -r requirements.txt

      echo ">>> Downloading qbcc.db"
      curl -f -L "https://storage.googleapis.com/sopal-bucket/qbcc.db" -o qbcc.db

      echo ">>> Checking file size"
      ls -lh qbcc.db
      test -s qbcc.db || (echo "âŒ qbcc.db missing!" && exit 1)
    startCommand: |
      echo ">>> Starting server"
      uvicorn server:app --host 0.0.0.0 --port $PORT
